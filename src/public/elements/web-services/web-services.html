<script type="text/javascript" src="../../bower_components/pxmoment/min/moment.min.js"></script>
<script>
  define('web-services', function() {
    return {
      getRangePresets: function(configs) {
        /**
        * @param {Array} configs
        * when configs is undefined or emtpy array @return defaultPresets(converted to an array)
        * for config items it will be a string or object
        * samples
        * ['oneWeek', 'oneYear']
        * [
        *  {
        *    key: '112',
        *    displayText: 'hahaha',
        *     startDateTime: Px.moment().clone().startOf('year').add(2, 'year'),
        *     endDateTime: Px.moment().clone().endOf('year').add(2, 'year')
        *   },
        *   'oneWeek',
        *   ...
        * ]
        */        
        var now = moment();

        var defaultPresets = {
          oneWeek: {
            displayText: '一周内',
            startDateTime: now.clone().subtract(7, 'days'),
            endDateTime: now
          },
          oneMonth: {
            displayText: '一月内',
            startDateTime: now.clone().subtract(1, 'month'),
            endDateTime: now
          },
          oneYear: {
            displayText: '一年内',
            startDateTime: now.clone().subtract(1, 'year'),
            endDateTime: now
          },
          currentMonth: {
            displayText: '本月',
            startDateTime: now.clone().startOf('month'),
            endDateTime: now.clone().endOf('month')
          },
          yearBeforeLast: {
            displayText: now.clone().startOf('year').subtract(2, 'year').year(),
            startDateTime: now.clone().startOf('year').subtract(2, 'year'),
            endDateTime: now.clone().endOf('year').subtract(2, 'year')
          },
          lastYear: {
            displayText: now.clone().startOf('year').subtract(1, 'year').year(),
            startDateTime: now.clone().startOf('year').subtract(1, 'year'),
            endDateTime: now.clone().endOf('year').subtract(1, 'year')
          },
          currentYear: {
            displayText: now.clone().startOf('year').year(),
            startDateTime: now.clone().startOf('year'),
            endDateTime: now.clone().endOf('year')
          },
          nextYear: {
            displayText: now.clone().startOf('year').add(1, 'year').year(),
            startDateTime: now.clone().startOf('year').add(1, 'year'),
            endDateTime: now.clone().endOf('year').add(1, 'year')
          },
          yearAfterNext: {
            displayText: now.clone().startOf('year').add(2, 'year').year(),
            startDateTime: now.clone().startOf('year').add(2, 'year'),
            endDateTime: now.clone().endOf('year').add(2, 'year')
          }
        };

        var rangePresets = [];
        if (!Array.isArray(configs) || (Array.isArray(configs) && !configs.length)) {
          rangePresets = Object.keys(defaultPresets).map(function(key) {
            return defaultPresets[key];
          });
        } else {
          // configs filter duplicated items
          rangePresets = configs.filter(function(config, i, array) {
            return i === array.indexOf(config)
          }).map(function(config) {
            if (typeof config === 'string' && defaultPresets[config]) {
              return defaultPresets[config];
            }

            var key = config.key;
            if (!key) return;

            var displayText = config.displayText;
            var startDateTime = config.startDateTime;
            var endDateTime = config.endDateTime;

            //startDateTime < endDateTime
            if (
              displayText
              && moment.isMoment(startDateTime)
              && moment.isMoment(endDateTime)
              && startDateTime < endDateTime
            ) {
              return config;
            }

            if (defaultPresets[key]) return defaultPresets[key];
          }).filter(function(n) {
            return n;
          });
        }

        return rangePresets;
      }      
    }
  });
</script>
