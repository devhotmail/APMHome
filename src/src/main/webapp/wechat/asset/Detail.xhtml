<?xml version="1.0" encoding="UTF-8"?>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">
    <h:head>
        <f:facet name="first">
            <meta charset="UTF-8"/>
            <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
            <meta name="apple-mobile-web-app-capable" content="yes" />
        </f:facet>
        <title>#{msg.AssetInfoDetail}</title>
        <h:outputStylesheet name="wechat/css/weui.min.css" />
        <h:outputStylesheet name="wechat/css/photoswipe.css" />
        <link type="text/css" rel="stylesheet" href="#{wechatUtilService.getContextPath()}/resources/wechat/css/default-skin.css" />
        <script type="text/javascript" src="#{wechatUtilService.getContextPath()}/resources/wechat/js/utils/jquery-3.1.1.min.js"/>
        <script type="text/javascript" src="#{wechatUtilService.getContextPath()}/resources/wechat/js/photoswipe.js"/>
        <script type="text/javascript" src="#{wechatUtilService.getContextPath()}/resources/wechat/js/photoswipe-ui-default.min.js"/>
        <script type="text/javascript" src="#{wechatUtilService.getContextPath()}/resources/wechat/js/detail.js"/>
        <script type="text/javascript" src="#{wechatUtilService.getContextPath()}/resources/wechat/js/utils/jweixin-1.2.0.js"/>

        <style>
            .weui-navbar__item.weui-bar__item_on {
                background-color: #f8f8f8;
                border-bottom: 1px solid #f8f8f8;
            }
            .weui-navbar:after {
                border-bottom: 0;
            }
            .weui-navbar__item:after {
                border-bottom: 0;
            }
            .weui-navbar__item {
                background-color: #eaeaea;
                border-bottom: 1px solid #ccc;
            }
        </style>

    </h:head>
    <body>
        <!-- Root element of PhotoSwipe. Must have class pswp. -->
        <div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

            <!-- Background of PhotoSwipe. 
                 It's a separate element as animating opacity is faster than rgba(). -->
            <div class="pswp__bg"></div>

            <!-- Slides wrapper with overflow:hidden. -->
            <div class="pswp__scroll-wrap">

                <!-- Container that holds slides. 
                    PhotoSwipe keeps only 3 of them in the DOM to save memory.
                    Don't modify these 3 pswp__item elements, data is added later on. -->
                <div class="pswp__container">
                    <div class="pswp__item"></div>
                    <div class="pswp__item"></div>
                    <div class="pswp__item"></div>
                </div>

                <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
                <div class="pswp__ui pswp__ui--hidden">

                    <div class="pswp__top-bar">

                        <!--  Controls are self-explanatory. Order can be changed. -->

                        <div class="pswp__counter"></div>

                        <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                        <button class="pswp__button pswp__button--share" title="Share"></button>

                        <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                        <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                        <!-- element will get class pswp__preloader- -active when preloader is running -->
                        <div class="pswp__preloader">
                            <div class="pswp__preloader__icn">
                                <div class="pswp__preloader__cut">
                                    <div class="pswp__preloader__donut"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                        <div class="pswp__share-tooltip"></div> 
                    </div>

                    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
                    </button>

                    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
                    </button>

                    <div class="pswp__caption">
                        <div class="pswp__caption__center"></div>
                    </div>

                </div>

            </div>

        </div>
        <div class="weui-gallery" id="gallery">
            <span class="weui-gallery__img" id="galleryImg"></span>
            <div class="weui-gallery__opr">
                <a href="javascript:" class="weui-gallery__del">
                    <i class="weui-icon-delete weui-icon_gallery-delete"></i>
                </a>
            </div>
        </div>

        <h:panelGroup  rendered="#{not empty wxAssetInfoController.assetInfo}" >  

            <div class="page__bd" style="height: 100%;">
                <div class="weui-tab">
                    <div class="weui-navbar">
                        <div id="tab1" class="weui-navbar__item weui-bar__item_on">
                            设备档案
                        </div>
                        <div id="tab2" class="weui-navbar__item">
                            报修记录
                        </div>
                    </div>
                    <div class="weui-tab__panel">
                        <div id="tab1Panel" class="">
                            <h:form id="updatePictureForm" rendered="#{userContextService.hasRole('AssetHead') or userContextService.hasRole('AssetStaff')}">
                                <p:remoteCommand name="updatePForm" actionListener="#{wxAssetInfoController.updateAttachmentPics()}" update="removedPicList addedPicList photoPanel" />
                                <h:inputHidden id="removedPicList" value="#{wxAssetInfoController.removedPicStr}"/>
                                <h:inputHidden id="addedPicList" value="#{wxAssetInfoController.addedPicStr}"/>
                                <div  class="weui-panel">
                                    <div class="weui-panel__hd">
                                        设备图片<h:panelGroup rendered="#{userContextService.hasRole('AssetStaff')}"><span id="modifyPicture" style="float: right">修改</span></h:panelGroup>
                                    </div>
                                    <h:panelGroup id="photoPanel">

                                        <div class="weui-panel__bd">
                                            <div class="weui-cell ">
                                                <div class="weui-cell__bd my-gallery" style="display: inline;" data-pswp-uid="1">
                                                    <c:forEach items="#{wxAssetInfoController.getPictureList(wxAssetInfoController.assetInfo.id)}" var="fileitem" varStatus="status">
                                                        <div style="display: inline-block;width: 78px">
                                                            <figure style="display: block; padding-right: 3px;" id="#{fileitem.fileId}">
                                                                <a href="" data-size="800x600">
                                                                    <p:graphicImage  value="#{pictureService.getImage()}"   height="78px" width="78px" >
                                                                        <f:param name="pictureId" value="#{fileitem.fileId}" />
                                                                    </p:graphicImage>
                                                                </a>
                                                            </figure>
                                                            <p class="removePicButton" align="center" onclick="showConfirmDialog(this);" style="display:none;width: 78px">
                                                                <i class="weui-icon-cancel"></i>
                                                            </p>
                                                        </div>
                                                    </c:forEach>
                                                </div>
                                            </div>
                                        </div>
                                    </h:panelGroup>
                                    <div class="weui-cells" id="wxUploader" style="display:none">
                                        <div class="weui-cell">
                                            <div class="weui-cell__bd">
                                                <div class="weui-uploader">
                                                    <div class="weui-uploader__bd">
                                                        <ul class="weui-uploader__files" id="uploaderFiles">
                                                        </ul>
                                                        <div class="weui-uploader__input-box">
                                                            <input id="uploaderInput" class="weui-uploader__input" type="file" accept="image/*" />
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </h:form>

                            <h:form id="updateMasterFieldForm">
                                <p:remoteCommand name="updateMForm" actionListener="#{wxAssetInfoController.updateFields(1)}" update=":updateMasterFieldForm" />
                                <div class="weui-panel">
                                    <div class="weui-panel__hd">设备基本属性<h:panelGroup rendered="#{userContextService.hasRole('AssetStaff')}"><span id="modifyFields" style="float: right" onclick="updateMForm();">#{wxAssetInfoController.isModifying[1]?"完成修改":"修改"}</span></h:panelGroup></div>
                                    <div class="weui-panel__bd ">
                                        <div class="weui-cell">
<!--                                            <div class="weui-cell__hd" style="position: relative;margin-right: 10px;">
                                                <img style="width: 50px;display: block"  src="#{wechatUtilService.getContextPath()}/resources/wechat/icons/assetgroup#{wxAssetInfoController.assetInfo.assetGroup}.ico"/>
                                            </div>-->
                                            <div class="weui-cell__bd">
                                                <p>#{wxAssetInfoController.assetInfo.name}</p>
                                                <p style="font-size: 13px;color: #888888;">#{wxAssetInfoController.assetInfo.aliasName}</p>
                                            </div>
                                            <div class="weui-cell__ft" >
                                                <h:outputText id="subscriberStat" value="#{wxAssetInfoController.messageSubscriber.receiveMsgMode=='0'?'未关注':''}#{wxAssetInfoController.messageSubscriber.receiveMsgMode=='1'?'已关注':''}#{wxAssetInfoController.messageSubscriber.receiveMsgMode=='2'?'部分关注':''}" >
                                                </h:outputText>
                                                <p><a href="javascript:settingSubscribe();"> 订阅设置</a></p>
                                            </div>
                                        </div>
                                        <div class="weui-cell">
                                            <div class="weui-cell__hd">
                                                <label class="weui-label">#{msg.status}</label>
                                            </div>
                                            <div class="weui-cell__bd">
                                                <h:outputText value="#{fieldMsg.fieldValue('assetStatus',wxAssetInfoController.assetInfo.status)}" rendered="#{!wxAssetInfoController.isModifying[1]}" />
                                                <h:selectOneMenu class="weui-select" value="#{wxAssetInfoController.assetInfo.status}" rendered="#{wxAssetInfoController.isModifying[1]}">
                                                    <f:selectItems value="#{fieldMsg.getFieldValueList('assetStatus')}" var="item" itemLabel="#{item.value}" itemValue="#{item.msgKey}"/>
                                                </h:selectOneMenu>
                                                
                                            </div>
                                            <div class="weui-cell__ft">
                                                <i class="#{wxAssetInfoController.assetInfo.status==1?'weui-icon-success':(wxAssetInfoController.assetInfo.status==2?'weui-icon-warn':'weui-icon-info-circle')}" />
                                            </div>
                                        </div>
                                        <div class="weui-cell">
                                            <div class="weui-cell__hd">
                                                <label class="weui-label">生产厂家</label>
                                            </div>
                                            <div class="weui-cell__bd">
                                                <h:outputText value="#{wxAssetInfoController.assetInfo.manufacture}" rendered="#{!wxAssetInfoController.isModifying[1]}"/>
                                                <h:inputText class="weui-input" value="#{wxAssetInfoController.assetInfo.manufacture}"  rendered="#{wxAssetInfoController.isModifying[1]}"/>
                                            </div>
                                        </div>

                                        <div class="weui-cell" onclick="javascript:showBRCode();">
                                            <div class="weui-cell__bd">
                                                <label class="weui-label">#{msg.qrCode}</label>
                                            </div>
                                            <div class="weui-cell__ft">
                                                <!--<p:barcode id='qrcode' class="weui-cell__ft" value="#{wxAssetInfoController.assetInfo.qrCode}" type="qr" height="20" format="png" rendered="#{not empty wxAssetInfoController.assetInfo.qrCode}" />-->
                                                <img id='qrcode' src="#{wxAssetInfoController.getQrCodeImageBase64()}" height="20px" width="20px"/>
                                            </div>
                                        </div>
                                        <div class="weui-cell">
                                            <div class="weui-cell__hd">
                                                <label class="weui-label">#{msg.clinicalDeptName}</label>
                                            </div>
                                            <div class="weui-cell__bd">
                                                <h:outputText value="#{wxAssetInfoController.assetInfo.clinicalDeptName}" rendered="#{!wxAssetInfoController.isModifying[1]}" />
                                                <h:selectOneMenu id="clinicalDeptName" class="weui-select" value="#{wxAssetInfoController.assetInfo.clinicalDeptId}" rendered="#{wxAssetInfoController.isModifying[1]}" >
                                                    <p:ajax  listener="#{wxAssetInfoController.onClinicalDeptChange()}"  update="clinicalOwnerName clinicalOwnerTel"/>
                                                    <f:selectItems value="#{wxAssetInfoController.getClinicalDeptList()}" var="item" itemLabel="#{item.name}" itemValue="#{item.id}"/>
                                                </h:selectOneMenu>
                                            </div>
                                        </div>
                                        <div class="weui-cell">
                                            <div class="weui-cell__hd">
                                                <label class="weui-label">#{msg.clinicalOwnerName}</label>
                                            </div>
                                            <div class="weui-cell__bd">
                                                <h:outputText value="#{wxAssetInfoController.assetInfo.clinicalOwnerName}" rendered="#{!wxAssetInfoController.isModifying[1]}" />
                                                <h:selectOneMenu class="weui-select" id="clinicalOwnerName" value="#{wxAssetInfoController.assetInfo.clinicalOwnerId}" rendered="#{wxAssetInfoController.isModifying[1]}">
                                                    <p:ajax  listener="#{wxAssetInfoController.onClinicalOwnerChange()}" update="clinicalOwnerTel" />
                                                    <f:selectItems value="#{wxAssetInfoController.getClinicalOwnerList()}" var="item" itemLabel="#{item.name}" itemValue="#{item.id}"/>
                                                </h:selectOneMenu>
                                            </div>
                                            <div class="weui-cell__ft">
                                                <h:outputText id="clinicalOwnerTel" value="#{wxAssetInfoController.assetInfo.clinicalOwnerTel}"/>
                                            </div>
                                        </div>
                                        <div class="weui-cell">
                                            <div class="weui-cell__hd">
                                                <label class="weui-label">负责人1</label>
                                            </div>
                                            <div class="weui-cell__bd">
                                                <h:outputText value="#{wxAssetInfoController.assetInfo.assetOwnerName}" rendered="#{!wxAssetInfoController.isModifying[1]}" />
                                                <h:selectOneMenu class="weui-select" id="assetOwnerId" value="#{wxAssetInfoController.assetInfo.assetOwnerId}" rendered="#{wxAssetInfoController.isModifying[1]}">
                                                    <p:ajax  listener="#{wxAssetInfoController.onAssetOwnerChange()}" update="assetOwnerTel" />
                                                    <f:selectItems value="#{wxAssetInfoController.getAssetOwnerList()}" var="item" itemLabel="#{item.name}" itemValue="#{item.id}"/>
                                                </h:selectOneMenu>
                                            </div>
                                            <div class="weui-cell__ft"><h:outputText id="assetOwnerTel" value="#{wxAssetInfoController.assetInfo.assetOwnerTel}"/></div>
                                        </div>
                                        <div class="weui-cell">
                                            <div class="weui-cell__hd">
                                                <label class="weui-label">负责人2</label>
                                            </div>
                                            <div class="weui-cell__bd">
                                                <h:outputText value="#{wxAssetInfoController.assetInfo.assetOwnerName2}" rendered="#{!wxAssetInfoController.isModifying[1]}" />
                                                <h:selectOneMenu class="weui-select" id="assetOwnerId2" value="#{wxAssetInfoController.assetInfo.assetOwnerId2}" rendered="#{wxAssetInfoController.isModifying[1]}">
                                                    <p:ajax  listener="#{wxAssetInfoController.onAssetOwner2Change()}" update="assetOwnerTel2" />
                                                    <f:selectItems value="#{wxAssetInfoController.getAssetOwnerList()}" var="item" itemLabel="#{item.name}" itemValue="#{item.id}"/>
                                                </h:selectOneMenu>
                                            </div>
                                            <div class="weui-cell__ft"><h:outputText id="assetOwnerTel2" value="#{wxAssetInfoController.assetInfo.assetOwnerTel2}"/></div>
                                        </div>
                                        <div class="weui-cell weui-cell_access">
                                            <div class="weui-cell__hd">
                                                <label class="weui-label">#{msg.purchaseDate}</label>
                                            </div>
                                            <div class="weui-cell__bd">
                                                <h:outputText value="#{wxAssetInfoController.assetInfo.purchaseDate}" rendered="#{!wxAssetInfoController.isModifying[1]}">
                                                    <f:convertDateTime pattern="yyyy-MM-dd"/>
                                                </h:outputText>
                                                <p:calendar id="purchaseDate" class="weui-input"  value="#{wxAssetInfoController.assetInfo.purchaseDate}" pattern="yyyy-MM-dd" rendered="#{wxAssetInfoController.isModifying[1]}"/>
                                            </div>
                                        </div>
                                        <div class="weui-cell weui-cell_access">
                                            <div class="weui-cell__hd">
                                                <label class="weui-label">#{msg.warrantyDate}</label>
                                            </div>
                                            <div class="weui-cell__bd">
                                                <h:outputText value="#{wxAssetInfoController.assetInfo.warrantyDate}" rendered="#{!wxAssetInfoController.isModifying[1]}">
                                                    <f:convertDateTime pattern="yyyy-MM-dd"/>
                                                </h:outputText>
                                                <p:calendar id="warrantyDate" class="weui-input"  value="#{wxAssetInfoController.assetInfo.warrantyDate}" pattern="yyyy-MM-dd" rendered="#{wxAssetInfoController.isModifying[1]}"/>
                                            </div>
                                        </div>


                                    </div>
                                </div>

                            </h:form>
                            <div class="weui-panel" id="detailPanel" style="display:none" >
                                <h:form id="updateDetailFieldForm" >
                                    <p:remoteCommand name="updateDForm" actionListener="#{wxAssetInfoController.updateFields(2)}" update=":updateDetailFieldForm" />
                                    <div class="weui-panel__hd">设备详细信息<h:panelGroup rendered="#{userContextService.hasRole('AssetStaff')}"><span  style="float: right" onclick="updateDForm();">#{wxAssetInfoController.isModifying[2]?"完成修改":"修改"}</span></h:panelGroup></div>
                                    <div class="weui-panel__bd">
                                        <div class="weui-cell">
                                            <div class="weui-cell__hd">
                                                <label class="weui-label">#{msg.aliasName}</label>
                                            </div>
                                            <div class="weui-cell__bd">
                                                <h:outputText value="#{wxAssetInfoController.assetInfo.aliasName}" rendered="#{!wxAssetInfoController.isModifying[2]}"/>
                                                <h:inputText class="weui-input" value="#{wxAssetInfoController.assetInfo.aliasName}"  rendered="#{wxAssetInfoController.isModifying[2]}"/>
                                            </div>
                                        </div>
                                        <div class="weui-cell">
                                            <div class="weui-cell__hd">
                                                <label class="weui-label">#{msg.serialNum}</label>
                                            </div>
                                            <div class="weui-cell__bd">
                                                <h:outputText value="#{wxAssetInfoController.assetInfo.serialNum}" rendered="#{!wxAssetInfoController.isModifying[2]}"/>
                                                <h:inputText class="weui-input" value="#{wxAssetInfoController.assetInfo.serialNum}"  rendered="#{wxAssetInfoController.isModifying[2]}"/>
                                            </div>
                                        </div>
                                        <div class="weui-cell">
                                            <div class="weui-cell__hd">
                                                <label class="weui-label">#{msg.vendor}</label>
                                            </div>
                                            <div class="weui-cell__bd">
                                                <h:outputText value="#{wxAssetInfoController.assetInfo.vendor}" rendered="#{!wxAssetInfoController.isModifying[2]}"/>
                                                <h:inputText class="weui-input" value="#{wxAssetInfoController.assetInfo.vendor}"  rendered="#{wxAssetInfoController.isModifying[2]}"/>
                                            </div>
                                        </div>
                                        <div class="weui-cell">
                                            <div class="weui-cell__hd">
                                                <label class="weui-label">#{msg.departNum}</label>
                                            </div>
                                            <div class="weui-cell__bd">
                                                <h:outputText value="#{wxAssetInfoController.assetInfo.departNum}" rendered="#{!wxAssetInfoController.isModifying[2]}"/>
                                                <h:inputText class="weui-input" value="#{wxAssetInfoController.assetInfo.departNum}"  rendered="#{wxAssetInfoController.isModifying[2]}"/>
                                            </div>
                                        </div>
                                        <div class="weui-cell">
                                            <div class="weui-cell__hd">
                                                <label class="weui-label">#{msg.assetGroup}</label>
                                            </div>
                                            <div class="weui-cell__bd">
                                                <h:outputText value="#{fieldMsg.fieldValue('assetGroup',wxAssetInfoController.assetInfo.assetGroup)}" rendered="#{!wxAssetInfoController.isModifying[2]}"/>
                                                <h:selectOneMenu class="weui-select" value="#{wxAssetInfoController.assetInfo.assetGroup}" rendered="#{wxAssetInfoController.isModifying[2]}">
                                                    <f:selectItems value="#{fieldMsg.getFieldValueList('assetGroup')}" var="item" itemLabel="#{item.value}" itemValue="#{item.msgKey}"/>
                                                </h:selectOneMenu>
                                            </div>
                                        </div>
                                        <div class="weui-cell">
                                            <div class="weui-cell__hd">
                                                <label class="weui-label">#{msg.functionGrade}</label>
                                            </div>
                                            <div class="weui-cell__bd">
                                                <h:outputText value="#{fieldMsg.fieldValue('assetFunctionGrade',wxAssetInfoController.assetInfo.functionGrade)}" rendered="#{!wxAssetInfoController.isModifying[2]}"/>
                                                <h:selectOneMenu class="weui-select" value="#{wxAssetInfoController.assetInfo.functionGrade}" rendered="#{wxAssetInfoController.isModifying[2]}">
                                                    <f:selectItems value="#{fieldMsg.getFieldValueList('assetFunctionGrade')}" var="item" itemLabel="#{item.value}" itemValue="#{item.msgKey}"/>
                                                </h:selectOneMenu>    
                                            </div>
                                        </div>
                                        <div class="weui-cell">
                                            <div class="weui-cell__hd">
                                                <label class="weui-label">#{msg.functionGroup}</label>
                                            </div>
                                            <div class="weui-cell__bd">
                                                <h:outputText value="#{fieldMsg.fieldValue('assetFunctionType',wxAssetInfoController.assetInfo.functionGroup)}" rendered="#{!wxAssetInfoController.isModifying[2]}"/>
                                                <h:selectOneMenu class="weui-select" value="#{wxAssetInfoController.assetInfo.functionGroup}" rendered="#{wxAssetInfoController.isModifying[2]}">
                                                    <f:selectItems value="#{fieldMsg.getFieldValueList('assetFunctionType')}" var="item" itemLabel="#{item.value}" itemValue="#{item.msgKey}"/>
                                                </h:selectOneMenu> 
                                            </div>
                                        </div>
                                        <div class="weui-cell">
                                            <div class="weui-cell__hd">
                                                <label class="weui-label">#{msg.maitanance}</label>
                                            </div>
                                            <div class="weui-cell__bd">
                                                <h:outputText value="#{wxAssetInfoController.assetInfo.maitanance}" rendered="#{!wxAssetInfoController.isModifying[2]}"/>
                                                <h:inputText class="weui-input" value="#{wxAssetInfoController.assetInfo.maitanance}"  rendered="#{wxAssetInfoController.isModifying[2]}"/>
                                            </div>
                                        </div>
                                        <div class="weui-cell">
                                            <div class="weui-cell__hd">
                                                <label class="weui-label">#{msg.maitananceTel}</label>
                                            </div>
                                            <div class="weui-cell__bd">
                                                <h:outputText value="#{wxAssetInfoController.assetInfo.maitananceTel}" rendered="#{!wxAssetInfoController.isModifying[2]}"/>
                                                <h:inputText class="weui-input" value="#{wxAssetInfoController.assetInfo.maitananceTel}"  rendered="#{wxAssetInfoController.isModifying[2]}"/>
                                            </div>
                                        </div>
                                        <div class="weui-cell">
                                            <div class="weui-cell__hd">
                                                <label class="weui-label">#{msg.financingNum}</label>
                                            </div>
                                            <div class="weui-cell__bd">
                                                <h:outputText value="#{wxAssetInfoController.assetInfo.financingNum}" rendered="#{!wxAssetInfoController.isModifying[2]}"/>
                                                <h:inputText class="weui-input" value="#{wxAssetInfoController.assetInfo.financingNum}"  rendered="#{wxAssetInfoController.isModifying[2]}"/>
                                            </div>
                                        </div>
                                        <div class="weui-cell">
                                            <div class="weui-cell__hd">
                                                <label class="weui-label">#{msg.barcode}</label>
                                            </div>
                                            <div class="weui-cell__bd">
                                                <h:outputText value="#{wxAssetInfoController.assetInfo.barcode}" rendered="#{!wxAssetInfoController.isModifying[2]}"/>
                                                <h:inputText class="weui-input" value="#{wxAssetInfoController.assetInfo.barcode}"  rendered="#{wxAssetInfoController.isModifying[2]}"/>
                                            </div>
                                        </div>
                                        <div class="weui-cell">
                                            <div class="weui-cell__hd">
                                                <label class="weui-label">#{msg.registrationNo}</label>
                                            </div>
                                            <div class="weui-cell__bd">
                                                <h:outputText value="#{wxAssetInfoController.assetInfo.registrationNo}" rendered="#{!wxAssetInfoController.isModifying[2]}"/>
                                                <h:inputText class="weui-input" value="#{wxAssetInfoController.assetInfo.registrationNo}"  rendered="#{wxAssetInfoController.isModifying[2]}"/>
                                            </div>
                                        </div>
                                        <div class="weui-cell">
                                            <div class="weui-cell__hd">
                                                <label class="weui-label">#{msg.modalityId}</label>
                                            </div>
                                            <div class="weui-cell__bd">
                                                <h:outputText value="#{wxAssetInfoController.assetInfo.modalityId}" rendered="#{!wxAssetInfoController.isModifying[2]}"/>
                                                <h:inputText class="weui-input" value="#{wxAssetInfoController.assetInfo.modalityId}"  rendered="#{wxAssetInfoController.isModifying[2]}"/>
                                            </div>
                                        </div>
                                        <div class="weui-cell">
                                            <div class="weui-cell__hd">
                                                <label class="weui-label">#{msg.locationCode}</label>
                                            </div>
                                            <div class="weui-cell__bd">
                                                <h:outputText value="#{wxAssetInfoController.assetInfo.locationCode}" rendered="#{!wxAssetInfoController.isModifying[2]}"/>
                                                <h:inputText class="weui-input" value="#{wxAssetInfoController.assetInfo.locationCode}"  rendered="#{wxAssetInfoController.isModifying[2]}"/>
                                            </div>
                                        </div>
                                        <div class="weui-cell">
                                            <div class="weui-cell__hd">
                                                <label class="weui-label">#{msg.locationName}</label>
                                            </div>
                                            <div class="weui-cell__bd">
                                                <h:outputText value="#{wxAssetInfoController.assetInfo.locationName}" rendered="#{!wxAssetInfoController.isModifying[2]}"/>
                                                <h:inputText class="weui-input" value="#{wxAssetInfoController.assetInfo.locationName}"  rendered="#{wxAssetInfoController.isModifying[2]}"/>
                                            </div>
                                        </div>
                                        <div class="weui-cell">
                                            <div class="weui-cell__hd">
                                                <label class="weui-label">#{msg.hospitalId}</label>
                                            </div>
                                            <div class="weui-cell__bd">#{wxAssetInfoController.assetInfo.hospital.name}</div>
                                        </div>
                                        <div class="weui-cell">
                                            <div class="weui-cell__hd">
                                                <label class="weui-label">#{msg.functionType}</label>
                                            </div>
                                            <div class="weui-cell__bd">
                                                <h:outputText value="#{wxAssetInfoController.assetInfo.functionType}" rendered="#{!wxAssetInfoController.isModifying[2]}"/>
                                                <h:inputText class="weui-input" value="#{wxAssetInfoController.assetInfo.functionType}"  rendered="#{wxAssetInfoController.isModifying[2]}"/>
                                            </div>
                                        </div>
                                        <div class="weui-cell">
                                            <div class="weui-cell__hd">
                                                <label class="weui-label">#{msg.manufactDate}</label>
                                            </div>
                                            <div class="weui-cell__bd">
                                                <h:outputText value="#{wxAssetInfoController.assetInfo.manufactDate}" rendered="#{!wxAssetInfoController.isModifying[2]}">
                                                    <f:convertDateTime pattern="yyyy-MM-dd"/>
                                                </h:outputText>
                                                <p:calendar  class="weui-input"  value="#{wxAssetInfoController.assetInfo.manufactDate}" pattern="yyyy-MM-dd" rendered="#{wxAssetInfoController.isModifying[2]}"/>
                                            </div>
                                        </div>
                                        <div class="weui-cell">
                                            <div class="weui-cell__hd">
                                                <label class="weui-label">#{msg.arriveDate}</label>
                                            </div>
                                            <div class="weui-cell__bd">
                                                <h:outputText value="#{wxAssetInfoController.assetInfo.arriveDate}" rendered="#{!wxAssetInfoController.isModifying[2]}">
                                                    <f:convertDateTime pattern="yyyy-MM-dd"/>
                                                </h:outputText>
                                                <p:calendar  class="weui-input"  value="#{wxAssetInfoController.assetInfo.arriveDate}" pattern="yyyy-MM-dd" rendered="#{wxAssetInfoController.isModifying[2]}"/>
                                            </div>
                                        </div>
                                        <div class="weui-cell">
                                            <div class="weui-cell__hd">
                                                <label class="weui-label">#{msg.installDate}</label>
                                            </div>
                                            <div class="weui-cell__bd">
                                                <h:outputText value="#{wxAssetInfoController.assetInfo.installDate}" rendered="#{!wxAssetInfoController.isModifying[2]}">
                                                    <f:convertDateTime pattern="yyyy-MM-dd"/>
                                                </h:outputText>
                                                <p:calendar  class="weui-input"  value="#{wxAssetInfoController.assetInfo.installDate}" pattern="yyyy-MM-dd" rendered="#{wxAssetInfoController.isModifying[2]}"/>
                                            </div>
                                        </div>
                                        <div class="weui-cell">
                                            <div class="weui-cell__hd">
                                                <label class="weui-label">#{msg.factoryWarrantyDate}</label>
                                            </div>
                                            <div class="weui-cell__bd">
                                                <h:outputText value="#{wxAssetInfoController.assetInfo.factoryWarrantyDate}" rendered="#{!wxAssetInfoController.isModifying[2]}">
                                                    <f:convertDateTime pattern="yyyy-MM-dd"/>
                                                </h:outputText>
                                                <p:calendar  class="weui-input"  value="#{wxAssetInfoController.assetInfo.factoryWarrantyDate}" pattern="yyyy-MM-dd" rendered="#{wxAssetInfoController.isModifying[2]}"/>
                                            </div>
                                        </div>
                                        <div class="weui-cell">
                                            <div class="weui-cell__hd">
                                                <label class="weui-label">#{msg.terminateDate}</label>
                                            </div>
                                            <div class="weui-cell__bd">
                                                <h:outputText value="#{wxAssetInfoController.assetInfo.terminateDate}">
                                                    <f:convertDateTime pattern="yyyy-MM-dd"/>
                                                </h:outputText>
                                            </div>
                                        </div>
                                        <div class="weui-cell">
                                            <div class="weui-cell__hd">
                                                <label class="weui-label">#{msg.lastPmDate}</label>
                                            </div>
                                            <div class="weui-cell__bd">
                                                <h:outputText value="#{wxAssetInfoController.assetInfo.lastPmDate}">
                                                    <f:convertDateTime pattern="yyyy-MM-dd"/>
                                                </h:outputText>
                                            </div>


                                        </div>
                                        <div class="weui-cell">
                                            <div class="weui-cell__hd">
                                                <label class="weui-label">#{msg.lastQaDate}</label>
                                            </div>
                                            <div class="weui-cell__bd">
                                                <h:outputText value="#{wxAssetInfoController.assetInfo.lastQaDate}">
                                                    <f:convertDateTime pattern="yyyy-MM-dd"/>
                                                </h:outputText>
                                            </div>
                                        </div>
                                        <div class="weui-cell">
                                            <div class="weui-cell__hd">
                                                <label class="weui-label">#{msg.lastMeteringDate}</label>
                                            </div>
                                            <div class="weui-cell__bd">
                                                <h:outputText value="#{wxAssetInfoController.assetInfo.lastMeteringDate}">
                                                    <f:convertDateTime pattern="yyyy-MM-dd"/>
                                                </h:outputText>
                                            </div>
                                        </div>
                                        <div class="weui-cell">
                                            <div class="weui-cell__hd">
                                                <label class="weui-label">#{msg.salvageValue}</label>
                                            </div>
                                            <div class="weui-cell__bd">
                                                <h:outputText value="#{wxAssetInfoController.assetInfo.salvageValue}">
                                                    <f:convertDateTime pattern="yyyy-MM-dd"/>
                                                </h:outputText>
                                            </div>
                                        </div>
                                        <div class="weui-cell">
                                            <div class="weui-cell__hd">
                                                <label class="weui-label">#{msg.purchasePrice}</label>
                                            </div>
                                            <div class="weui-cell__bd">
                                                <h:outputText value="#{wxAssetInfoController.assetInfo.purchasePrice}" rendered="#{!wxAssetInfoController.isModifying[2]}"/>
                                                <h:inputText class="weui-input"  value="#{wxAssetInfoController.assetInfo.purchasePrice}" rendered="#{wxAssetInfoController.isModifying[2]}">
                                                    <f:convertNumber minIntegerDigits="0"  minFractionDigits="0" />
                                                </h:inputText>
                                            </div>
                                        </div>
                                        <div class="weui-cell">
                                            <div class="weui-cell__hd">
                                                <label class="weui-label">#{msg.lifecycle}</label>
                                            </div>
                                            <div class="weui-cell__bd">
                                                <h:outputText value="#{wxAssetInfoController.assetInfo.lifecycleInYear}" rendered="#{!wxAssetInfoController.isModifying[2]}"/>
                                                <h:inputText class="weui-input"  value="#{wxAssetInfoController.assetInfo.lifecycleInYear}" rendered="#{wxAssetInfoController.isModifying[2]}">
                                                    <f:convertNumber minIntegerDigits="0"  minFractionDigits="0" />
                                                </h:inputText>
                                            </div>
                                        </div>
                                        <div class="weui-cell">
                                            <div class="weui-cell__hd">
                                                <label class="weui-label">#{msg.depreciationMethod}</label>
                                            </div>
                                            <div class="weui-cell__bd">
                                                <h:outputText value="#{fieldMsg.fieldValue('depreciationMethodList',wxAssetInfoController.assetInfo.depreciationMethod)}" rendered="#{!wxAssetInfoController.isModifying[2]}"/>
                                                <h:selectOneMenu class="weui-select" id="depreciationMethod" value="#{wxAssetInfoController.assetInfo.depreciationMethod}" rendered="#{wxAssetInfoController.isModifying[2]}">
                                                    <f:selectItems value="#{fieldMsg.getFieldValueList('depreciationMethodList')}" var="item" itemLabel="#{item.value}" itemValue="#{item.msgKey}"/>
                                                </h:selectOneMenu>
                                            </div>
                                        </div>
                                    </div>
                                </h:form>
                            </div>
                            <h:panelGroup rendered="#{userContextService.hasRole('AssetHead')}">
	                            <p class="weui-btn-area" >
	                                <a id="viewMore" href="javascript:showDetails();" class="weui-btn weui-btn_primary" >查看更多信息</a>
	                            </p>
                            </h:panelGroup>
                        </div>
                        <div id="tab2Panel" class="weui-tab__content">

                            <div class="page__bd">

                                <h:panelGroup rendered="#{empty wxAssetInfoController.srList}">
                                    <div class="weui-cells">
                                        <div class="weui-cell">
                                            <div class="weui-cell__bd">
                                                <h4> #{msg.noRecordFound}</h4>
                                            </div>
                                        </div>
                                    </div>
                                </h:panelGroup>

                                <div class="weui-msg__opr-area">
                                    <p class="weui-btn-area">
                                        <a href="/wx/createWo?id=#{wxAssetInfoController.assetInfo.id}&amp;openid=#{wxAssetInfoController.getUserOpenId()}" class="weui-btn weui-btn_primary">新增报修</a>
                                        <!--<a href="#{wechatUtilService.getContextPath()}/web/scanworeport?from=detail&amp;qrCode=#{wxAssetInfoController.assetInfo.qrCode}" class="weui-btn weui-btn_primary">新增报修</a>-->
                                    </p>
                                </div>

                                <c:forEach  items="#{wxAssetInfoController.srList}" var="srItem" >
                                    <div class="weui-cells">
                                        <div class="weui-cell">
                                            <div class="weui-cell__bd">
                                                <h4>工单</h4>
                                                <p>报修人：#{srItem.requestorName}</p>
                                                <p>故障现象：#{srItem.requestReason}</p>
                                            </div>
                                            <div class="ftitle weui-cell__ft" style="#{srItem.casePriority==1?'color:red':''}#{srItem.casePriority==2?'color:orange':'color:green'};">#{fieldMsg.fieldValue("casePriority",srItem.casePriority)}</div>
                                        </div>
                                        <c:forEach  items="#{wxAssetInfoController.getWorkOrderList(srItem.id)}" var="woItem" >
                                        
                                            <a class="weui-cell weui-cell_access" href="/wx/workorder/#{woItem.id}?openid=#{wxAssetInfoController.getUserOpenId()}">
                                                <div class="show-data weui-cell__bd">
                                                    <h4>当前步骤：</h4>
                                                </div>
                                                <div class="weui-cell__ft reportview">#{woItem.currentStepName}</div>
                                            </a>
                                        </c:forEach>
<!--                                         <a class="weui-cell weui-cell_access" href="#{wechatUtilService.getContextPath()}/web/scanwodetail?from=detail&amp;woId=#{item.id}">
                                            <div class="show-data weui-cell__bd">
                                                <h4>当前步骤：</h4>
                                            </div>
                                            <div class="weui-cell__ft reportview">#{item.status}</div>
                                        </a>-->
                                    </div>
                                </c:forEach>

                            </div>
                        </div>
                    </div>
                </div>
            </div>


        </h:panelGroup>
        <h:panelGroup  rendered="#{empty wxAssetInfoController.assetInfo}" >  
            <div class="page">
                <div class="weui-msg">
                    <div class="weui-msg__icon-area"><i class="weui-icon-warn weui-icon_msg"></i></div>
                    <p>
                        <h:outputText value="设备未找到" rendered="#{wxAssetInfoController.assetFlag==0}"/> 
                        <h:outputText value="设备未建档" rendered="#{wxAssetInfoController.assetFlag==1}"/> 
                        <h:outputText value="设备建档中" rendered="#{wxAssetInfoController.assetFlag==2}"/> 
                        <h:outputText value="没有权限查看" rendered="#{wxAssetInfoController.assetFlag==3}"/> 
                    </p>
                    <p>#{wxAssetInfoController.qrCode}</p>
                    <div class="weui-msg__opr-area">
                        <p class="weui-btn-area">
                            <!--<a href="assetList.xhtml?action=list&amp;qrCode=#{wxAssetInfoController.qrCode}" class="weui-btn weui-btn_primary">#{msg.BindAsset}</a>-->
                            <a href="List.xhtml" class="weui-btn weui-btn_primary">返回设备列表</a>
                            <h:panelGroup rendered="#{wxAssetInfoController.assetFlag==2}">
                                <a href="createInfoDetail.xhtml?openId=#{wxAssetInfoController.currentUser.weChatId}&amp;qrCode=#{wxAssetInfoController.qrCode}" class="weui-btn weui-btn_primary" >查看建档信息</a>
                            </h:panelGroup>
                        </p>
                    </div>
                </div>
            </div>
        </h:panelGroup>

        <div id="dialogs">

            <!--BEGIN dialog1-->
            <h:form id="subscribrSetting">
                <div class="js_dialog" id="settingDialog" style="display: none;">
                    <div class="weui-mask"></div>
                    <div class="weui-dialog">
                        <div class="weui-dialog__hd"><strong class="weui-dialog__title">订阅设置</strong></div>
                        <div class="weui-dialog__bd page__bd">
                            <div class="weui-cells__title" style="text-align:left;color: #000000;">关注选项</div>
                            <div class="weui-cells weui-cells_radio">
                                <label class="weui-cell weui-check__label" for="subscribrSetting:subsMsgRadio:0">
                                    <div class="weui-cell__hd">工单全部消息</div>
                                    <div class="weui-cell__bd"></div>
                                    <div class="weui-cell__ft">
                                        <input type="radio" class="weui-check" name="subscribrSetting:subsMsgRadio" id="subscribrSetting:subsMsgRadio:0" value="1" checked="#{wxAssetInfoController.messageSubscriber.receiveMsgMode==1?'checked':''}"/>
                                        <span class="weui-icon-checked"></span>
                                    </div>
                                </label>
                                <label class="weui-cell weui-check__label" for="subscribrSetting:subsMsgRadio:1">
                                    <div class="weui-cell__hd">工单主要消息</div>
                                    <div class="weui-cell__bd"></div>
                                    <div class="weui-cell__ft">
                                        <input type="radio" class="weui-check" name="subscribrSetting:subsMsgRadio" id="subscribrSetting:subsMsgRadio:1" value="2" checked="#{wxAssetInfoController.messageSubscriber.receiveMsgMode==2?'checked':''}"/>
                                        <span class="weui-icon-checked"></span>
                                    </div>
                                </label>
                                <label class="weui-cell weui-check__label" for="subscribrSetting:subsMsgRadio:2">
                                    <div class="weui-cell__hd">取消关注</div>
                                    <div class="weui-cell__bd"></div>
                                    <div class="weui-cell__ft">
                                        <input type="radio" class="weui-check" name="subscribrSetting:subsMsgRadio" id="subscribrSetting:subsMsgRadio:2" value="0" checked="#{wxAssetInfoController.messageSubscriber.receiveMsgMode==0?'checked':''}"/>
                                        <span class="weui-icon-checked"></span>
                                    </div>
                                </label>
                            </div>
                            <div class="weui-cells__title" style="text-align:left;color: #000000;">接收选项</div>
                            <div class="weui-cells">
                                <div class="weui-cell">
                                    <div class="weui-cell__hd">工单超时消息</div>
                                    <div class="weui-cell__bd"></div>
                                    <div class="weui-cell__ft">
                                        <label for="subscribrSetting:isReceiveTimeoutMsg" class="weui-switch-cp">
                                            <h:selectBooleanCheckbox id="isReceiveTimeoutMsg" class="weui-switch-cp__input"   value="#{wxAssetInfoController.messageSubscriber.isReceiveTimeoutMsg}"/>
                                            <div class="weui-switch-cp__box"></div>
                                        </label>
                                    </div>
                                </div>
                                <div class="weui-cell">
                                    <div class="weui-cell__hd">工单对话消息</div>
                                    <div class="weui-cell__bd"></div>
                                    <div class="weui-cell__ft">
                                        <label for="subscribrSetting:isReceiveChatMsg" class="weui-switch-cp">
                                            <h:selectBooleanCheckbox id="isReceiveChatMsg" class="weui-switch-cp__input" value="#{wxAssetInfoController.messageSubscriber.isReceiveChatMsg}" />
                                            <div class="weui-switch-cp__box"></div>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <p:remoteCommand actionListener="#{wxAssetInfoController.settingMsgSubscriber()}" name="settingSubmit"  update=":updateMasterFieldForm:subscriberStat"  oncomplete="hiddenInput();"/>
                        <div class="weui-dialog__ft">
                            <a href="javascript:closeDialog();" class="weui-dialog__btn weui-dialog__btn_default">取消</a>
                            <a href="javascript:settingSubmit();closeDialog();" class="weui-dialog__btn weui-dialog__btn_primary">确定</a>
                        </div>
                    </div>
                </div>
            </h:form>
        </div>

        <!--BEGIN dialog1-->
        <div class="js_dialog" id="confirmDialog" style="display: none;">
            <div class="weui-mask"></div>
            <div class="weui-dialog">
                <div class="weui-dialog__hd"><strong class="weui-dialog__title">删除确认</strong></div>
                <div class="weui-dialog__bd">照片删除将无法找回，请确认</div>
                <div class="weui-dialog__ft">
                    <a id="cancelConfirmDialog" href="javascript:;" class="weui-dialog__btn weui-dialog__btn_default">取消</a>
                    <a id="submitConfirmDialog" href="javascript:;" class="weui-dialog__btn weui-dialog__btn_primary">确定删除</a>
                </div>
            </div>
        </div>
        <!--END dialog1-->
        <!--BEGIN dialog2-->
        <div class="js_dialog" id="messageDialog" style="display: none;">
            <div class="weui-mask"></div>
            <div class="weui-dialog">
                <div id="dialogInfoDiv" class="weui-dialog__bd"></div>
                <div class="weui-dialog__ft">
                    <a id="dialogInfoA" href="javascript:;" class="weui-dialog__btn weui-dialog__btn_primary">知道了</a>
                </div>
            </div>
        </div>
        <!--END dialog2-->

    </body>
    <script>
        //<![CDATA[
        var closeDialog = function () {
            $('#settingDialog').fadeOut(200);
        };



        function showBRCode() {
            var imgt = "background-image:url(#url#)";
            $("#galleryImg").attr("style", imgt.replace('#url#', $("#qrcode")[0].src));
            $('.weui-gallery__del').css("display", "none");
            $("#gallery").fadeIn(100);
        }

        $("#gallery").on("click", function () {
            $("#gallery").fadeOut(100);
            $('.weui-gallery__del').css("display", "block");
        });

        $('.weui-navbar__item').on('click', function () {
            $(this).addClass('weui-bar__item_on').siblings('.weui-bar__item_on').removeClass('weui-bar__item_on');
            var tabid = this.id + "Panel";
            $("#" + tabid).removeClass("weui-tab__content").siblings().addClass('weui-tab__content');
        });

        function settingSubscribe() {
            var $iosDialog1 = $('#settingDialog');
            $iosDialog1.fadeIn(200);
        }

        function showDetails() {

            if ($("#detailPanel").css('display') == 'none') {
                $("#detailPanel").css('display', 'block');
                $("#viewMore").html("收起");
            } else {
                $("#detailPanel").css('display', 'none');
                $("#viewMore").html("查看更多信息");
            }
        }


        function showConfirmDialog(picElement) {
            $("#confirmDialog").fadeIn(200);
            $("#cancelConfirmDialog").on("click", function () {
                $("#confirmDialog").fadeOut(200);
                $("#submitConfirmDialog").unbind("click");
            });
            $("#submitConfirmDialog").on("click", function () {
                var pic = $(picElement).parent();
                var listStr = $("#updatePictureForm\\:removedPicList").val();
                $("#updatePictureForm\\:removedPicList").val(listStr + $(pic).children("figure").attr("id") + ",");
                $(pic).remove();
                $("#confirmDialog").fadeOut(200);
                $("#submitConfirmDialog").unbind("click");
            });
        }

        function showDialog(dialogInfo) {
            $("#dialogInfoDiv").html(dialogInfo);
            $("#messageDialog").fadeIn(200);
        }

        $("#dialogInfoA").on("click", function () {
            $("#dialogInfoDiv").html();
            $("#messageDialog").fadeOut(200);
        });


        $("#modifyPicture").on('click', function () {
            if ($("#modifyPicture").text() == "修改") {
                $("#modifyPicture").text("完成修改");
                $(".removePicButton").css("display", "block");
                $("#wxUploader").css("display", "block");
                $.each($(".weui-uploader__file"), function (index, value) {
                    $(value).remove();
                });

            } else {
                $("#modifyPicture").text("修改");
                $(".removePicButton").css("display", "none");
                $("#wxUploader").css("display", "none");
                var listStr = "";
                $.each($(".weui-uploader__file"), function (index, value) {
                    listStr = listStr + value.id + ",";
                });

                $("#updatePictureForm\\:addedPicList").val(listStr);
                updatePForm();
            }
        });

        var jsSignature = #{wechatUtilService.getJsSignature()};
        var currentShowImageId = "";

        wx.config({
            debug: false, // 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。
            appId: jsSignature.appid, // 必填，公众号的唯一标识
            timestamp: jsSignature.timestamp, // 必填，生成签名的时间戳
            nonceStr: jsSignature.noncestr, // 必填，生成签名的随机串
            signature: jsSignature.signature, // 必填，签名，见附录1
            jsApiList: ['uploadImage', 'chooseImage'] // 必填，需要使用的JS接口列表，所有JS接口列表见附录2
        });

        var tmpl = '<li class="weui-uploader__file" style="background-image:url(#url#)"></li>',
                $gallery = $("#gallery"), $galleryImg = $("#galleryImg"),
                $uploaderInput = $("#uploaderInput"),
                $uploaderFiles = $("#uploaderFiles");

        $uploaderInput.on("click", function (e) {
            var num = $("#uploaderFiles").children().length;
            if (num >= 5) {
                showDialog("最多只能添加5张图片");
            } else {
                wx.chooseImage({
                    count: 5 - num, // 默认9
                    sizeType: ['compressed'], // 可以指定是原图还是压缩图，默认二者都有['original'原图, 'compressed'压缩图]
                    sourceType: ['album', 'camera'], // 可以指定来源是相册还是相机，默认二者都有
                    success: function (res) {
                        var localIds = res.localIds; // 返回选定照片的本地ID列表，localId可以作为img标签的src属性显示图片
                        syncUpload(localIds);
                    }
                });
            }
            return false;
        });

        $uploaderFiles.on("click", "li", function () {
            $galleryImg.attr("style", this.getAttribute("style"));
            $gallery.fadeIn(100);
            currentShowImageId = $(this).attr("id");
//            $("#currentShowImageId").val($(this).attr("id"));
        });

        $('.weui-gallery__del').on('click', function () {
//            var tempImageId = $("#currentShowImageId").val();

            $("#" + currentShowImageId).remove();
            currentShowImageId = "";

            countImage();
        });

        function syncUpload(localIds) {
            var localId = localIds.pop();
            wx.uploadImage({
                localId: localId,
                isShowProgressTips: 1,
                success: function (res) {
                    var serverId = res.serverId; // 返回图片的服务器端ID

                    if (window.__wxjs_is_wkwebview) {
                        wx.getLocalImgData({
                            localId: localId,
                            success: function (ress) {
                                var localData = ress.localData.replace('jgp', 'jpeg');
                                $uploaderFiles.append($(tmpl.replace('#url#', localData)).attr('id', serverId));
                                countImage();
                            }
                        });

                    } else {
                        $uploaderFiles.append($(tmpl.replace('#url#', localId)).attr('id', serverId));
                        countImage();
                    }

                    //其他对serverId做处理的代码
                    if (localIds.length > 0) {
                        syncUpload(localIds);
                    }
                }
            });
        }

        function countImage() {
            var num = $("#uploaderFiles").children().length;

            $("#imageNumDiv").html(num + "/5");

            return num;
        }


//]]>
    </script>


</html>
