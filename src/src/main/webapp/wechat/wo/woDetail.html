<%@taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<script type="text/html" id="ts_wodetail">
    <div class="page">
        <jsp:include page="progressbar.html"/>

        <div class="page__bd">
            <div class="weui-form-preview">
                <div class="weui-form-preview__bd">
                    <div class="weui-form-preview__item">
                        <label class="weui-form-preview__label">资产名称</label>
                        <span class="weui-form-preview__value" id="assetName"></span>
                        <input id="assetId" type="hidden"/>
                    </div>
                    <div class="weui-form-preview__item">
                        <label class="weui-form-preview__label">供应商</label>
                        <span class="weui-form-preview__value" id="supplier"></span>
                    </div>
                    <div class="weui-form-preview__item">
                        <label class="weui-form-preview__label">紧急程度</label>
                        <span class="weui-form-preview__value" id="assetGroup"></span>
                    </div>
                </div>
            </div>

            <!--图片 -->
            <div class="weui-cells__title">故障图片上传<div class="weui-uploader__info" style="float: right;">0/5</div></div>
            <div class="weui-cells">
                <div class="weui-cell">
                    <div class="weui-cell__bd">
                        <div class="weui-uploader">
                            <div class="weui-uploader__bd">
                                <ul class="weui-uploader__files" id="uploaderFiles">
                                </ul>
                                <div class="weui-uploader__input-box">
                                    <input id="uploaderInput" class="weui-uploader__input" type="file" accept="image/*" />
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!--语音-->
            <div class="weui-cells__title">故障语音描述</div>
            <div class="weui-cells">
                <div class="weui-cell">
                    <div class="weui-cell__bd">
                        <button class="weui-btn voice-btn" type="button" id="replay">播放</button>
                    </div>
                </div>
            </div>
            <!--故障现象-->
            <div class="weui-cells__title">故障文字描述</div>
            <div class="weui-cells">
                <div class="weui-cell">
                    <div class="weui-cell__bd">
                        <span name="requestReason" id="requestReason">
                        </span>
                    </div>
                </div>
            </div>
    
            <div id="showMsgs" style="display: none">
                <div class="weui-cells__title">交互详情</div>
                <div class="weui-cells">
                    <a class="weui-cell weui-cell_access" href="javascript:;">
                        <div class="show-data weui-cell__bd">
                            <span style="color: #999"></span>
                        </div>
                        <div class="weui-cell__ft">
                        </div>
                    </a>
                </div>
            </div>
            
            <div id="showAssign" style="display: none">
                <!--派工-->
                <div class="weui-cells__title">维修人员*</div>
                <div class="weui-cells">
                    <div class="weui-cell">
                        <div class="weui-cell__bd">
                            <div class="weui-cell weui-cell_select">
                                <div class="weui-cell__bd">
                                    <select class="weui-select" name="currentPersonId" id="currentPersonId" >
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="submitType" style="display: none">
                <div class="weui-btn-area" style="margin-bottom: 20px">
                    <a class="weui-btn weui-btn_primary" href="javascript:" id="submit">
                    </a>
                </div>
            </div>

        </div>
    </div>
    <script type="text/javascript">
        $(function(){
            $.get(WEB_ROOT+'web/wodetail', {id: pageManager.woId}, function(ret) {
                if (ret) {
                    app.activeProgressBar(ret.currentStepId);
                    //set value
                    app.setFormJsonValue(ret);
                } 
            });
            if (pageManager.showMsgs) {
                $('#showMsgs').show();
                $.get(WEB_ROOT+'web/msg/'+ pageManager.woId, function(ret) {
                    if (ret && ret.length !== 0) {
                        var msg = ret[0];
                        $('#showMsgs').find('span').html(msg.message);
                    } else {
                        $('#showMsgs').find('span').html('暂时还没有交互信息');
                    }
                });
            }
            
            $('#showMsgs').on('click', '.weui-cell_access', function(){
                pageManager.go('#ts_msglist');
            });
            
            if (pageManager.showAssign) {
                $('#showAssign').show();
                app.initUserSelect('currentPersonId', 'getcurrentperson');
            }
            
            if (pageManager.showBtn) {
                $('#submitType').show();
                switch(pageManager.step) {
                    case 2: $('#submit').html('派单');break;
                    case 3: $('#submit').html('领单');break;
                    case 4: $('#submit').html('签到');break;
                    case 5: $('#submit').html('关单');break;
                    default: $('#submit').html('反馈');
                }
            }
            
        });
</script>
