<script type="text/html" id="ts_scanreportlist">
    <div class="page">
        <div class="page__bd" style="height: 100%;">
            <div class="weui-btn-area">
                <a class="weui-btn weui-btn_primary" href="javascript:" id="listresubmit">新增报修</a>
            </div>
            <div id="scanreportlist" class="page__bd page__bd_spacing">
            </div>
        </div>
    </div>
    <script type="text/javascript">
        $(function(){
            app.intCasePriority();
            //data search function
            pageManager.scanreportlist = function() {
                var $loadingToast1 = $('#loadingToast1');
                if ($loadingToast1.css('display') !== 'none') return;
                $loadingToast1.fadeIn(100);
                //fetch data from server    wolistdata is the restful url
                $.get(WEB_ROOT+'web/scanreportlist', {assetId: pageManager.assetId}, function(ret) {
                    var data = [];
                    if (ret && ret.length !== 0) {
                        $.each(ret, function(i, v){
                            data.push({title:'工单编号: '+ v['id'], 
                                       ftitle: pageManager.msgTypes['casePriority'][v['casePriority']], 
                                       ftitleColor : v['casePriority']===1?'#F76260':v['casePriority']===2?'#FFBE00':'#09BB07',
                                       rater:  -1,
                                       data : ['资产编号：'+v['assetId'],
                                                '资产名称：'+v['assetName'],
                                                '报修人：'+v['requestorName'],
                                                '报修时间：'+v['requestTime'],
                                               '工单状态：'+v['currentStepName'],
                                               '当前人员：'+v['currentPersonName']]});
                        });
                    } 
                    //show the data list
                    app.fullListItem('scanreportlist', data);
                    $loadingToast1.fadeOut(100);
                });
            }
            
            //go create page
            $('#listresubmit').click(function(){
                pageManager.go('ts_scanAsset');
            });

            //bind click event
            $('#scanreportlist').on('click', '.weui-cell_access', function(){
                var $loadingToast = $('#loadingToast1');
                if ($loadingToast.css('display') === 'none') {
                    $loadingToast.fadeIn(100);
                }
                pageManager.woId = $(this).parent().find('h4').html().split(': ')[1];
                pageManager.createType = 'uncloseList';
                pageManager.go('#ts_recreate');
            });
            pageManager.scanreportlist();
        });
</script>
