<link rel="import" href="../polymer/polymer.html"/>
<link rel="import" href="../px-polymer-font-awesome/px-polymer-font-awesome.html">

<link rel="import" href="device-pagination-styles.html">
<dom-module id="device-pagination">
  <template>
    <style include="device-pagination-styles"></style>
    <div class="u-pl+ u-ml+ summary">
      <span
        class="btn btn--bare btn--pagination u-p- previous"
        class$="{{_getPrevCls(current)}}"
        on-click="handlePrev">
        <iron-icon icon="fa:fa-angle-left"></iron-icon>
      </span>
      <span class="counter" id="counter">
        <template is="dom-if" if="{{showInput}}">
          <input id="currentInput"
            type="text"
            value="{{current::input}}"
            on-keydown="handleInputKeydown">
        </template>
        <template is="dom-if" if="{{!showInput}}">
          <span class="current"
            on-click="handleShowInput">{{current}}</span>
        </template>
        <span> / {{total}}</span>
      <span
        class="btn btn--bare btn--pagination u-p- next"
        class$="{{_getNextCls(current, total)}}"
        on-click="handleNext">
        <iron-icon icon="fa:fa-angle-right"></iron-icon>
      </span>
    </div>
  </template>
</dom-module>

<script>
  Polymer({
    is: 'device-pagination',
    properties: {
      total: {
        type: Number,
        value: 5
      },
      current: {
        type: Number,
        value: 1
      },
      showInput: {
        type: Boolean,
        value: false
      }
    },
    _getPrevCls: function (current) {
      return current === 1 ? 'btn--disabled' : '';
    },
    _getNextCls: function (current, total) {
      return current === total ? 'btn--disabled' : '';
    },
    handlePrev: function () {
      if (this.current > 1) this.changePage(this.current - 1);
    },
    handleNext: function () {
      if (this.current < this.total) this.changePage(this.current + 1);
    },
    changePage: function (n) {
      if (n) this.current = n;
    },
    handleShowInput: function () {
      this.showInput = true;
      this.async((function() {
        this.$.counter.querySelector('#currentInput').focus();
      }).bind(this));
    },
    updateCurrentWithUI: function () {
      if (this.current > this.total) this.current = this.total;
      if (this.current < 1) this.current = 1;
      this.showInput = false;
    },
    handleInputKeydown: function (e) {
      var keycode = event.which || event.keyCode;
      if (keycode === 13) this.updateCurrentWithUI();
    },
    handleBlur: function (e) {
      var inputEl = this.$.counter.querySelector('#currentInput');
      if (inputEl && inputEl.contains(e.target)) return;
      // when blur
      this.updateCurrentWithUI();
    },
    ready: function () {
      window.addEventListener('mousedown', this.handleBlur.bind(this));
    },
    detached: function () {
      window.removeEventListener('mousedown', this.handleBlur.bind(this));
    }
  });
</script>
