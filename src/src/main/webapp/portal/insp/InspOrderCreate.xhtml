<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                template="/WEB-INF/template.xhtml">

    <ui:define name="content">
        <p align="center">
            <b>#{msg.InspectionOrder}</b>
        </p>

        <h:form id="InspectionOrderEditForm">
            <p:fieldset legend="#{msg.BasicInfo}" style="margin-bottom:20px">
                <p:panelGrid columns="4" layout="grid" styleClass="ui-panelgrid-blank form-group" >
                    <!--                    <h:panelGroup>
                                            <label class="label">#{msg.id}*</label>
                                            <p:inputText id="id" value="#{inspectionOrderController.selected.id}"  required="true" requiredMessage="#{msg.id} #{msg.ValidationRequire}"/>
                                        </h:panelGroup>-->
                    <h:panelGroup>
                        <label class="label">#{msg.name}*</label>
                        <p:inputText id="name" value="#{inspectionOrderController.selected.name}"  required="true" requiredMessage="#{msg.name} #{msg.ValidationRequire}"/>
                    </h:panelGroup>
                    <h:panelGroup>
                        <label class="label">#{msg.creator}*</label>
                        <p:inputText id="creator" value="#{inspectionOrderController.selected.creatorName}"  readonly="true"/>
                    </h:panelGroup>
                    <h:panelGroup>
                        <label class="label">#{msg.createTime}*</label>
                        <p:calendar id="createTime" pattern="yyyy/MM/dd HH:mm:ss" value="#{inspectionOrderController.selected.createTime}" readonly="true" showOn="button" readonlyInput="false" showButtonPanel="true" navigator="true" mask="true"/>
                    </h:panelGroup>
                    <h:panelGroup>
                        <label class="label">#{msg.ownerName}*</label>
                        <!--<p:inputText id="ownerName" value="#{inspectionOrderController.selected.ownerName}"  required="true" requiredMessage="#{msg.ownerName} #{msg.ValidationRequire}"/>-->
                        <p:selectOneMenu id="ownerName" value="#{inspectionOrderController.owner}" converter="userAccountConverter"  var="t"  filter="true" filterMatchMode="startsWith" required="true" requiredMessage="#{msg.assetOwnerName} #{msg.ValidationRequire}" >
                            <p:ajax listener="#{inspectionOrderController.onOwnerChange}" process="@this" update="ownerOrgId"/>
                            <f:selectItem itemLabel="" />
                            <f:selectItems value="#{assetInfoController.ownerList}" var="item" itemLabel="#{item.name}" itemValue="#{item}"/>
                            <p:column>
                                <h:outputText value="#{t.name}"/>
                            </p:column>
                            <p:column>
                                <h:outputText value="#{t.telephone}"/>
                            </p:column>
                        </p:selectOneMenu>
                    </h:panelGroup>
                    <h:panelGroup>
                        <label class="label">#{msg.ownerOrgId}*</label>
                        <p:inputText id="ownerOrgId" value="#{inspectionOrderController.selected.ownerOrgName}" readonly="true"/>
                    </h:panelGroup>
                    <h:panelGroup>
                        <label class="label">#{msg.startTime}</label>
                        <p:calendar id="startTime" pattern="yyyy/MM/dd" value="#{inspectionOrderController.selected.startTime}" showOn="button" readonlyInput="false" showButtonPanel="true" navigator="true" mask="true" required="true" requiredMessage="#{msg.startTime} #{msg.ValidationRequire}"/>
                    </h:panelGroup>
                    <h:panelGroup>
                        <label class="label">#{msg.endTime}</label>
                        <p:calendar id="endTime" pattern="yyyy/MM/dd" value="#{inspectionOrderController.selected.endTime}" showOn="button" readonlyInput="false" showButtonPanel="true" navigator="true" mask="true" required="true" requiredMessage="#{msg.endTime} #{msg.ValidationRequire}"/>
                    </h:panelGroup>
                    <h:panelGroup>
                        <label class="label">#{msg.period}</label>
                         <p:selectOneMenu id="functionType" value="#{inspectionOrderController.period}" style="width: 100%" required="true" requiredMessage="#{msg.period} #{msg.ValidationRequire}" >
                            <f:selectItem itemLabel="#{msg.selectOneMessage}"/>
                            <f:selectItems value="#{fieldMsg.getFieldValueList('inspectionPeriod')}" var="item" itemLabel="#{item.value}" itemValue="#{item.msgKey}"/>
                        </p:selectOneMenu>
                        <!--<p:calendar id="period" pattern="yyyy/MM/dd" value="#{inspectionOrderController.selected.endTime}" showOn="button" readonlyInput="false" showButtonPanel="true" navigator="true" mask="true"/>-->
                    </h:panelGroup>

                    <h:panelGroup>
                        <label class="label">#{msg.comments}</label>
                        <p:inputText id="comments" value="#{inspectionOrderController.selected.comments}" />
                    </h:panelGroup>

                </p:panelGrid>
            </p:fieldset>


            <p:fieldset legend="#{msg.BasicInfo}" style="margin-bottom:20px">
                <p:panelGrid columns="2" layout="grid" styleClass="ui-panelgrid-blank form-group" >
                    <h:panelGroup>
                        <label class="label">#{msg.assetName}</label>
                        <p:tree id="assetTree" class="tree" style="border:0;" value="#{inspectionOrderController.orgAssetTree}" selection="#{inspectionOrderController.selectedNodes}"  var="node"  dynamic="false" cache="true" selectionMode="checkbox" highlight="true">
                            <p:ajax event="select" listener="#{inspectionOrderController.onSelectTreeNode}" update=":InspectionOrderEditForm:dataList"/>
                            <p:ajax event="unselect" listener="#{inspectionOrderController.onUnselectTreeNode}" update=":InspectionOrderEditForm:dataList"/>

                            <p:treeNode type="org">
                                <h:outputText value="#{node.name}"/>
                            </p:treeNode>
                            <p:treeNode type="asset" icon="ui-icon-wifi-tethering">
                                <h:outputText value="#{node.name}"/>
                            </p:treeNode>
                        </p:tree>
                    </h:panelGroup>

                    <p:dataList id="dataList" value="#{inspectionOrderController.selectedNodesList}" var="asset"   type="unordered">
                        <f:facet name="header">
                            #{msg.assetName}
                        </f:facet>
                        <h:outputText value="#{asset.data.name}" />
                        <!--#{asset.data.name}-->
                        <!--<p:commandButton process="@this" actionListener="#{inspectionOrderController.removeSelectedAsset(asset)}" id="iconOnly" update="dataList :InspectionOrderEditForm:assetTree" icon="ui-icon-clear" title="#{msg.Delete}" class="popupIconButton"/>-->
                    </p:dataList>
                </p:panelGrid>


            </p:fieldset>
            <p:fieldset legend="#{msg.attachmentUrl}" style="margin-bottom:20px">
                <p:panelGrid columns="2" layout="grid" styleClass="ui-panelgrid-blank form-group" >
                    <h:panelGroup >
                        <p:dataList id="pictureList" value="#{assetInfoController.getAttachList(assetInfoController.selected.id,1)}" var="fileitem" type="definition">
                            <f:facet name="header">#{fieldMsg.fieldValue('attachmentType', 1)}</f:facet>

                            #{fileitem.name}
                            <p:commandButton immediate="true" actionListener="#{assetInfoController.removeAttachment(fileitem.fileId)}" id="iconOnly" update="pictureList" icon="ui-icon-clear" title="#{msg.Delete}" class="popupIconButton">
                                <p:confirm header="#{msg.DeleteConformation}" message="#{msg.DeleteConformationMsg}" icon="ui-icon-warning"/>  
                            </p:commandButton>
                        </p:dataList>
                        <p:fileUpload id="type1" fileUploadListener="#{assetInfoController.handleFileUpload}" mode="advanced" dragDropSupport="false" style="width:100%"
                                      multiple="true"  sizeLimit="1000000" fileLimit="3" allowTypes="/(\.|\/)(gif|jpe?g|png)$/" update="pictureList"/>
                    </h:panelGroup>
                </p:panelGrid>

            </p:fieldset>

<!--<p:dialog id="InspectionOrderEditDlg" widgetVar="InspectionOrderEditDialog" modal="true" resizable="true" draggable="true" appendTo="@(body)" header="#{inspectionOrderController.CRUDActionName} #{msg.InspectionOrder}">-->
            <h:panelGroup id="display">

                <h:panelGroup >
                    <p:commandButton value="#{msg.Save}" action="#{inspectionOrderController.createOrder()}" validateClient="true" style="float:right"/>  
                    <p:commandButton value="#{msg.Return}" action="InspOrderList?faces-redirect=true" immediate="true" style="float:right"/>  
                </h:panelGroup>
            </h:panelGroup>
        </h:form>
        <br/>
        <br/>
        <br/>
        <!--</p:dialog>-->

    </ui:define>
</ui:composition>