<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:c="http://java.sun.com/jsp/jstl/core"
                xmlns:p="http://primefaces.org/ui"
                template="/WEB-INF/template.xhtml">

    <ui:define name="title">assetProcurement</ui:define>

    <ui:define name="head">
        <h:outputStylesheet name="css/assetProcurement.css"/>
        <h:outputScript name="js/jqplot.canvasOverlay.js"/>
        <h:outputScript name="js/assetProcurement.js"/>
    </ui:define>

    <ui:define name="content">
        <h:form>
            <p:growl id="messages" showDetail="true"/>

            <header>
                <div class="card--title text--center">
                    <span class="epsilon">辅助决策分析</span>
                </div>
                <div class="card--summary ui-g ui-fluid">
                    <div class="ui-md-4">
                        <div class="epsilon u-mv-">设备购买建议</div>
                        <div class="text--banner delta">
                            1
                            <span class="text--unit text--secondary">台</span>
                        </div>
                    </div>
                    <div class="ui-md-4">
                        <div class="epsilon u-mv-">设备安排合理化</div>
                        <div class="text--banner delta">
                            1
                            <span class="text--unit text--secondary">台</span>
                        </div>
                    </div>
                    <div class="ui-md-4">
                        <div class="epsilon u-mv-">预测总收益增加</div>
                        <div class="text--banner delta">
                            20
                            <span class="text--unit text--secondary">万元</span>
                        </div>
                    </div>
                </div>
            </header>
            <div class="block">
                <c:forEach var="i" begin="0"
                           end="${assetProcurementController.detailsSize/assetProcurementController.colSize}"
                           varStatus="status">
                    <section class="device-brief-list">
                        <div class="ui-g">
                            <c:forEach var="j" begin="${i*assetProcurementController.colSize+1}"
                                       end="${i*assetProcurementController.colSize+assetProcurementController.colSize}">
                                <c:if test="${j le assetProcurementController.detailsSize}">
                                    <div class="ui-g-2">
                                        <a href="#device-detail-${j}" class="device-block ${assetProcurementController.detail(j-1).suggestion != '无'? 'device-block--alert' : ''}">
                                            <h2 class="device-block-title">
                                                ${assetProcurementController.detail(j-1).groupName}</h2>
                                            <p class="device-block-subtitle">平均使用率预测:</p>
                                            <h3 class="${assetProcurementController.detail(j-1).forecastAvgUtilPercent > 100? 'text--alert' : ''}">
                                                ${assetProcurementController.detail(j-1).forecastAvgUtilPercent} %
                                            </h3>
                                            <p class="device-block-subtitle">建议:</p>
                                            <p>${assetProcurementController.detail(j-1).suggestion}</p>
                                            <hr/>
                                            <p class="device-block-subtitle">使用率预测:</p>
                                            <p>${assetProcurementController.detail(j-1).forecastResult}</p>
                                            <p:chart class="brief-chart" type="bar"
                                                     model="${assetProcurementController.detail(j-1).forecastBriefChart}"
                                                     responsive="true"/>
                                        </a>
                                    </div>
                                </c:if>
                            </c:forEach>
                        </div>
                    </section>
                    <section class="device-details-list">
                        <c:forEach var="j" begin="${i*assetProcurementController.colSize+1}"
                                   end="${i*assetProcurementController.colSize+assetProcurementController.colSize}">
                            <c:if test="${j le assetProcurementController.detailsSize}">
                                <div id="device-detail-${j}" class="device-block-wrapper">
                                    <div class="device-block device-detail-block ${assetProcurementController.detail(j-1).suggestion != '无'? 'device-block--alert' : ''}">
                                        <h2 class="device-block-title">
                                            ${assetProcurementController.detail(j-1).groupName}
                                        </h2>
                                        <div class="ui-g">
                                            <div class="ui-g-9">
                                                <p>根据历史数据进行使用率预测:</p>
                                                <br/>
                                                <br/>
                                                <div class="ui-g">
                                                    <div class="ui-g-4">
                                                        <p class="device-block-subtitle">
                                                            ${assetProcurementController.lastSndYearStart}-${assetProcurementController.lastSndYearEnd}
                                                        </p>
                                                        <h2 class="${assetProcurementController.detail(j-1).lastSndYearAvgUtilPercent > 100? 'text--alert' : ''}">
                                                            ${assetProcurementController.detail(j-1).lastSndYearAvgUtilPercent}%</h2>
                                                        <p:chart type="bar"
                                                                 model="${assetProcurementController.detail(j-1).lastSndYearChart}"
                                                                 responsive="true"/>
                                                    </div>
                                                    <div class="ui-g-4">
                                                        <p class="device-block-subtitle">
                                                            ${assetProcurementController.lastSndYearStart}-${assetProcurementController.lastSndYearEnd}
                                                        </p>
                                                        <h2 class="${assetProcurementController.detail(j-1).lastSndYearAvgUtilPercent > 100? 'text--alert' : ''}">
                                                            ${assetProcurementController.detail(j-1).lastSndYearAvgUtilPercent}%
                                                        </h2>
                                                        <p:chart type="bar"
                                                                 model="${assetProcurementController.detail(j-1).lastSndYearChart}"
                                                                 responsive="true"/>
                                                    </div>
                                                    <div class="ui-g-4">
                                                        <p class="device-block-subtitle">
                                                            ${assetProcurementController.lastFstYearStart}-${assetProcurementController.lastFstYearEnd}
                                                        </p>
                                                        <h2 class="${assetProcurementController.detail(j-1).lastFstYearAvgUtilPercent > 100? 'text--alert' : ''}">
                                                            ${assetProcurementController.detail(j-1).lastFstYearAvgUtilPercent}%</h2>
                                                        <p:chart widgetVar="predictBarChart" class="chart-with-legend" type="bar"
                                                                 model="${assetProcurementController.detail(j-1).lastFstYearChart}"
                                                                 responsive="true"/>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="ui-g-2 u-ph+ divide-line-left">
                                                <p class="device-block-subtitle">设备使用建议:</p>
                                                <br/>
                                                <p>${assetProcurementController.detail(j-1).suggestion}</p>
                                                <p class="device-block-subtitle">原设备预测使用率:</p>
                                                <p:dataTable var="entry"
                                                             value="#{assetProcurementController.detail(j-1).assetUtilForecasts.entrySet().toArray()}">
                                                    <p:column headerText="设备名称">
                                                        <h:outputText value="#{entry.key}"/>
                                                    </p:column>
                                                    <p:column headerText="使用率">
                                                        <h:outputText class="${entry.value > 100? 'text--alert' : ''}" value="#{entry.value}%"/>
                                                    </p:column>
                                                </p:dataTable>
                                                <c:if
                                                test="${(detail.forecastUtilAfterAction > 0) and (detail.suggestion.contains('购买'))}">
                                                    <p class="device-block-subtitle">采取建议后使用率预测:</p>
                                                    <p>
                                                        ${assetProcurementController.detail(j-1).forecastUtilAfterAction}％平均使用率</p>
                                                </c:if>
                                            </div>
                                            <div class="ui-g-1 u-ph+ divide-line-left">
                                                <p>设备收益预测:</p>
                                                <br/>
                                                <p class="device-block-subtitle">不采取建议收益预测:</p>
                                                <h2>120万元</h2>
                                                <br/>
                                                <br/>
                                                <p class="device-block-subtitle">采取建议后收益预测:</p>
                                                <h2>140万元</h2>
                                                <br/>
                                                <br/>
                                                <p class="device-block-subtitle">采取建议后增收:</p>
                                                <h2>140万元</h2>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </c:if>
                        </c:forEach>
                    </section>
                </c:forEach>
            </div>
        </h:form>
    </ui:define>
</ui:composition>
